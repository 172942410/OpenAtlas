#!/bin/bash 
if [[ $# < 1 || $1 == "--help" ]]
then
echo "Usage: DisplayAllAdjacentModels.sh AtlasName"
echo "       Displays all models (.vtk and .stl) for each label in an atlas"
echo "       Available Atlases are;"
echo "         `ls -1 @OpenAtlas_SOURCE_DIR@/Atlases`"
exit 1
fi

Atlas=$1
OpenAtlasHome=@OpenAtlas_SOURCE_DIR@

# Make missing directories
if [ ! -d $OpenAtlasHome/Atlases/$Atlas/Models ] ; then
  mkdir -p $OpenAtlasHome/Atlases/$Atlas/Models
fi

if [ ! -d $OpenAtlasHome/Atlases/$Atlas/Models/Screenshot ] ; then
  mkdir -p $OpenAtlasHome/Atlases/$Atlas/Models/Screenshot
fi

pushd $OpenAtlasHome/Atlases/$Atlas/Models

all=`ls -1 VTK| sort | cut -d"-" -f2 | cut -d"." -f1,1`
echo $all

AppDir=""
if [ `uname` == "Darwin" ]; then AppDir=DisplayAdjacentModels.app/Contents/MacOS/ ; fi

if [ ! -f ./adjacencies.txt ] ; then
    echo "$Prog: $OpenAtlasHome/Atlases/$Atlas/Models/adjacencies.txt not found"
    echo "$Prog: Please run @OpenAtlas_BINARY_DIR@/GenerateAdjacencies.sh"
    exit 1
fi

for i in $all; do
@OpenAtlas_BINARY_DIR@/$AppDir/DisplayAdjacentModels $i $OpenAtlasHome/Atlases/$Atlas/Atlas/${Atlas}Colors.ctbl ./adjacencies.txt $OpenAtlasHome/Atlases/$Atlas/Models/Screenshot/
done
popd
